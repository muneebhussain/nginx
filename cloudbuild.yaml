steps:
  # This step builds the container image.
  - name: gcr.io/cloud-builders/docker
    args:
      - build
      - '-t'
      - 'gcr.io/marshad-sc-lab/my-nginx:$SHORT_SHA'
      - .
    # This step pushes the image to Artifact Registry
    id: build Step
  - name: gcr.io/cloud-builders/docker
    args:
      - push
      - 'gcr.io/marshad-sc-lab/my-nginx:$SHORT_SHA'
    id: push Step
  - name: gcr.io/cloud-builders/gke-deploy
    args:
      - prepare
      - '--filename=gs://nginx-cicd/deployment.yaml'
      - '--image=gcr.io/marshad-sc-lab/my-nginx:$SHORT_SHA'
      - '--app=frontend'
      - '--version=$SHORT_SHA'
      - '--namespace=xyz'
      - '--output=gs://nginx-cicd/ouput'
      - '--annotation=gcb-build-id=$BUILD_ID'
    id: Prepare Account Service Kubernetes YAML
  - name: gcr.io/cloud-builders/gke-deploy
    args:
      - apply
      - '--filename=gs://nginx-cicd/ouput/expanded/*'
      - '--namespace=xyz'
      - '--cluster=cluster-1'
      - '--location=us-central1-c'
    id: Deploy Account Service in K8s
